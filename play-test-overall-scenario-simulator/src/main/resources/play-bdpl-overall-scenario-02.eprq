#
# Selective pattern detecting 4 company-related events in sequence bounded by a time window
# and filtering twitter events for number of friends and more.
#

PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX uctelco: <http://events.event-processing.org/uc/telco/>
PREFIX geo:     <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX xsd:     <http://www.w3.org/2001/XMLSchema#>
PREFIX :        <http://events.event-processing.org/types/>

CONSTRUCT {
	:e rdf:type :UcTelcoEsrRecom .
	:e :stream <http://streams.event-processing.org/ids/OverallResults02#stream> .
	:e uctelco:ackRequired "false"^^xsd:boolean .
	:e uctelco:answerRequired "false"^^xsd:boolean .
	:e :message "Pattern 02: Four company-related events were detected using stricter filters."^^xsd:string .
	:e uctelco:action <blank://action1> .
	<blank://action1> rdf:type uctelco:OpenTwitter ;
		:screenName ?p02screenName01 , ?p02screenName02 , ?p02screenName03 , ?p02screenName04 .
	:e :members ?p02e1 , ?p02e2 , ?p02e3 , ?p02e4 .
}
WHERE {
	WINDOW {
		EVENT ?p02id1 {
			?p02e1 rdf:type :google .
			?p02e1 :stream <http://streams.event-processing.org/ids/TwitterFeed#stream> .
			?p02e1 :screenName ?p02screenName01 .
			?p02e1 :isRetweet "false" .
			?p02e1 :friendsCount ?p02friendsCount01 .
			}
			FILTER(?p02friendsCount01 > "10")
		SEQ
		EVENT ?p02id2 {
			?p02e2 rdf:type :apple .
			?p02e2 :stream <http://streams.event-processing.org/ids/TwitterFeed#stream> .
			?p02e2 :screenName ?p02screenName02 .
			?p02e2 :isRetweet "false" .
			?p02e2 :friendsCount ?p02friendsCount02 .
			}
			FILTER(?p02friendsCount02 > "10")
		SEQ
		EVENT ?p02id3 {
			?p02e3 rdf:type :microsoft .
			?p02e3 :stream <http://streams.event-processing.org/ids/TwitterFeed#stream> .
			?p02e3 :screenName ?p02screenName03 .
			?p02e3 :isRetweet "false" .
			?p02e3 :friendsCount ?p02friendsCount03 .
			}
			FILTER(?p02friendsCount03 > "10")
		SEQ
		EVENT ?p02id4 {
			?p02e4 rdf:type :yahoo .
			?p02e4 :stream <http://streams.event-processing.org/ids/TwitterFeed#stream> .
			?p02e4 :screenName ?p02screenName04 .
			?p02e4 :isRetweet "false" .
			?p02e4 :friendsCount ?p02friendsCount04 .
			}
			FILTER(?p02friendsCount04 > "10")
	} ("PT5S"^^xsd:duration, sliding)
}
